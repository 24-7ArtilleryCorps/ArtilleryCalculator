<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artillery Elevation Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1, h2, h3 {
            text-align: center;
        }
        label {
            font-weight: bold;
        }
        input[type="number"], select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #28a745;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #218838;
        }
        .result {
            margin-top: 20px;
        }
        .result p {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 4px;
        }
        .section {
            margin-bottom: 40px;
        }
        .error {
            border-color: red;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Artillery Elevation Calculator</h1>

    <!-- Section 1: Calculate Barrel Elevation Based on Distance -->
    <div class="section">
        <h2>Calculate Barrel Elevation</h2>
        <label for="distance">Enter Distance (meters):</label>
        <input type="number" id="distance" placeholder="Enter distance in meters">

        <label for="muzzleVelocity">Muzzle Velocity (m/s):</label>
        <input type="number" id="muzzleVelocity" value="199.34" required>

        <label for="fireMode">Fire Mode:</label>
        <select id="fireMode">
            <option value="direct">Direct Fire</option>
            <option value="indirect">Indirect Fire</option>
        </select>

        <button onclick="calculateElevation()">Calculate Elevation</button>
        
        <div class="result" id="result"></div>
    </div>
    <!-- Section 2: Calculate True Distance with Elevation Difference -->
    <div class="section">
        <h2>Calculate True Distance with Elevation Difference</h2>
        <label for="horizontalDistance">Enter Horizontal Distance (meters):</label>
        <input type="number" id="horizontalDistance" placeholder="Enter horizontal distance in meters">
        
        <label for="elevationDifference">Enter Elevation Difference (meters):</label>
        <input type="number" id="elevationDifference" placeholder="Enter elevation difference in meters">
        
        <button onclick="calculateTrueDistance()">Calculate True Distance</button>
        
        <div class="result" id="trueDistanceResult"></div>
    </div>

<!-- Scripts for Section 1 and Section 2 -->
<script>
// Function to validate input and calculate barrel elevation based on distance and fire mode
function calculateElevation() {
    const distanceInput = document.getElementById("distance");
    const muzzleVelocityInput = document.getElementById("muzzleVelocity");
    const fireMode = document.getElementById("fireMode").value;
    const resultDiv = document.getElementById("result");

    // Clear previous results and error messages
    resultDiv.innerHTML = "";
    distanceInput.classList.remove("error");
    muzzleVelocityInput.classList.remove("error");

    const distance = parseFloat(distanceInput.value);
    const muzzleVelocity = parseFloat(muzzleVelocityInput.value);

    // Input validation
    if (isNaN(distance) || distance <= 0) {
        distanceInput.classList.add("error");
        resultDiv.innerHTML = "<p>Please enter a valid distance greater than 0.</p>";
        return;
    }

    if (isNaN(muzzleVelocity) || muzzleVelocity <= 0) {
        muzzleVelocityInput.classList.add("error");
        resultDiv.innerHTML = "<p>Please enter a valid muzzle velocity greater than 0.</p>";
        return;
    }

    const g = 9.81; // Gravity in m/s^2

    // Calculate direct fire angle in radians
    let directAngleRad = Math.asin((distance * g) / (muzzleVelocity ** 2)) / 2;

    // Convert to degrees
    let directAngleDeg = directAngleRad * (180 / Math.PI);

    // Convert to mils
    let directAngleMil = directAngleDeg / 0.05625;

    let elevationMil;

    // If indirect fire is selected, calculate the indirect angle
    if (fireMode === 'indirect') {
        let indirectAngleDeg = 90 - directAngleDeg;
        let indirectAngleMil = indirectAngleDeg / 0.05625;

        // Cap the indirect fire at the turret's maximum elevation of 1309 mils
        elevationMil = indirectAngleMil > 1309 ? 1309 : indirectAngleMil;
    } else {
        elevationMil = directAngleMil;
    }

    // Display the result
    resultDiv.innerHTML = `<p>Elevation: ${elevationMil.toFixed(2)} mils</p>`;
}

// Function to validate input, calculate true distance with elevation difference, and feed it to Section 1
function calculateTrueDistance() {
    const horizontalDistanceInput = document.getElementById("horizontalDistance");
    const elevationDifferenceInput = document.getElementById("elevationDifference");
    const resultDiv = document.getElementById("trueDistanceResult");

    // Clear previous results and error messages
    resultDiv.innerHTML = "";
    horizontalDistanceInput.classList.remove("error");
    elevationDifferenceInput.classList.remove("error");

    const horizontalDistance = parseFloat(horizontalDistanceInput.value);
    const elevationDifference = parseFloat(elevationDifferenceInput.value);

    // Input validation
    if (isNaN(horizontalDistance) || horizontalDistance <= 0) {
        horizontalDistanceInput.classList.add("error");
        resultDiv.innerHTML = "<p>Please enter a valid horizontal distance greater than 0.</p>";
        return;
    }

    if (isNaN(elevationDifference)) {
        elevationDifferenceInput.classList.add("error");
        resultDiv.innerHTML = "<p>Please enter a valid elevation difference.</p>";
        return;
    }

    // Calculate true distance using Pythagorean theorem
    const trueDistance = Math.sqrt(Math.pow(horizontalDistance, 2) + Math.pow(elevationDifference, 2));
    resultDiv.innerHTML = `<p>True Distance: ${trueDistance.toFixed(2)} meters</p>`;

    // Automatically feed true distance to Section 1
    document.getElementById("distance").value = trueDistance.toFixed(2);
}
</script>
    <!-- Section 3: Calculate Target Details with Elevation -->
    <div class="section">
        <h2>Calculate Target Details with Elevation</h2>
        
        <!-- Observer Details -->
        <h3>Observer Details (Optional)</h3>
        <label for="observer_x">Observer X Coordinate:</label>
        <input type="number" id="observer_x" placeholder="Enter observer X coordinate">
        
        <label for="observer_y">Observer Y Coordinate:</label>
        <input type="number" id="observer_y" placeholder="Enter observer Y coordinate">
        
        <label for="observer_bearing">Bearing from Observer (degrees):</label>
        <input type="number" id="observer_bearing" placeholder="Enter bearing from observer">
        
        <label for="observer_distance">Distance from Observer (meters):</label>
        <input type="number" id="observer_distance" placeholder="Enter distance from observer">
        
        <label for="observer_elevation">Observer Elevation (meters):</label>
        <input type="number" id="observer_elevation" placeholder="Enter observer elevation">

        <label for="elevation_difference">Elevation Difference to Target (meters):</label>
        <input type="number" id="elevation_difference" placeholder="Enter elevation difference from observer to target">

        <!-- Target Coordinates -->
        <h3>Target Coordinates (If Known)</h3>
        <label for="target_x">Target X Coordinate:</label>
        <input type="number" id="target_x" placeholder="Enter target X coordinate">
        
        <label for="target_y">Target Y Coordinate:</label>
        <input type="number" id="target_y" placeholder="Enter target Y coordinate">

        <label for="target_elevation">Target Elevation (meters):</label
 <input type="number" id="target_elevation" placeholder="Enter target elevation">

        <!-- Your Coordinates -->
        <h3>Your Coordinates</h3>
        <label for="your_x">Your X Coordinate:</label>
        <input type="number" id="your_x" placeholder="Enter your X coordinate">
        
        <label for="your_y">Your Y Coordinate:</label>
        <input type="number" id="your_y" placeholder="Enter your Y coordinate">
        
        <label for="your_elevation">Your Elevation (meters):</label>
        <input type="number" id="your_elevation" placeholder="Enter your elevation">

        <button onclick="calculateTargetDetails()">Calculate Target Details</button>
        
        <div class="result" id="targetResult"></div>
    </div>
</div>

<!-- Scripts for Section 3 -->
<script>
// Function to validate input, calculate target details based on observer and target coordinates, and feed it to Section 1
function calculateTargetDetails() {
    const observerXInput = document.getElementById("observer_x");
    const observerYInput = document.getElementById("observer_y");
    const observerBearingInput = document.getElementById("observer_bearing");
    const observerDistanceInput = document.getElementById("observer_distance");
    const observerElevationInput = document.getElementById("observer_elevation");
    const elevationDifferenceInput = document.getElementById("elevation_difference");

    const targetXInput = document.getElementById("target_x");
    const targetYInput = document.getElementById("target_y");
    const targetElevationInput = document.getElementById("target_elevation");

    const yourXInput = document.getElementById("your_x");
    const yourYInput = document.getElementById("your_y");
    const yourElevationInput = document.getElementById("your_elevation");

    const resultDiv = document.getElementById("targetResult");

    // Clear previous results and error messages
    resultDiv.innerHTML = "";
    observerXInput.classList.remove("error");
    observerYInput.classList.remove("error");
    observerBearingInput.classList.remove("error");
    observerDistanceInput.classList.remove("error");
    observerElevationInput.classList.remove("error");
    elevationDifferenceInput.classList.remove("error");
    targetXInput.classList.remove("error");
    targetYInput.classList.remove("error");
    targetElevationInput.classList.remove("error");
    yourXInput.classList.remove("error");
    yourYInput.classList.remove("error");
    yourElevationInput.classList.remove("error");

    const yourX = parseFloat(yourXInput.value);
    const yourY = parseFloat(yourYInput.value);
    const yourElevation = parseFloat(yourElevationInput.value);

    // Input validation for your coordinates and elevation
    if (isNaN(yourX) || isNaN(yourY) || isNaN(yourElevation)) {
        yourXInput.classList.add("error");
        yourYInput.classList.add("error");
        yourElevationInput.classList.add("error");
        resultDiv.innerHTML = "<p>Please enter valid values for your coordinates and elevation.</p>";
        return;
    }

    let targetX = parseFloat(targetXInput.value);
    let targetY = parseFloat(targetYInput.value);
    let targetElevation = parseFloat(targetElevationInput.value);

    if (isNaN(targetX) || isNaN(targetY)) {
        // If target coordinates are not entered, calculate them using observer details
        const observerX = parseFloat(observerXInput.value);
        const observerY = parseFloat(observerYInput.value);
        const observerBearing = parseFloat(observerBearingInput.value);
        const observerDistance = parseFloat(observerDistanceInput.value);

        // Input validation for observer details
        if (isNaN(observerX) || isNaN(observerY) || isNaN(observerBearing) || isNaN(observerDistance)) {
            observerXInput.classList.add("error");
            observerYInput.classList.add("error");
            observerBearingInput.classList.add("error");
            observerDistanceInput.classList.add("error");
            resultDiv.innerHTML = "<p>Please enter valid observer details or target coordinates.</p>";
            return;
        }

        // Convert bearing to radians
        const bearingRad = observerBearing * (Math.PI / 180);

        // Calculate target coordinates
        targetX = observerX + observerDistance * Math.cos(bearingRad);
        targetY = observerY + observerDistance * Math.sin(bearingRad);
    }

    if (isNaN(targetElevation)) {
        // If target elevation is not entered, calculate it using observer elevation and elevation difference
        const observerElevation = parseFloat(observerElevationInput.value);
        const elevationDifference = parseFloat(elevationDifferenceInput.value);

        if (isNaN(observerElevation) || isNaN(elevationDifference)) {
            observerElevationInput.classList.add("error");
            elevationDifferenceInput.classList.add("error");
            resultDiv.innerHTML = "<p>Please enter valid observer elevation and elevation difference.</p>";
            return;
        }
        targetElevation = observerElevation + elevationDifference;
    }

    // Calculate distance from your position to the target
    const horizontalDistanceToTarget = Math.sqrt(Math.pow(targetX - yourX, 2) + Math.pow(targetY - yourY, 2));
    const trueDistanceToTarget = Math.sqrt(Math.pow(horizontalDistanceToTarget, 2) + Math.pow(targetElevation - yourElevation, 2));

    // Calculate bearing from your position to the target
    let bearingToTarget = Math.atan2(targetY - yourY, targetX - yourX) * (180 / Math.PI);
    if (bearingToTarget < 0) {
        bearingToTarget += 360;
    }

    // Display the results
    resultDiv.innerHTML = `<p>Target Coordinates: (${targetX.toFixed(2)}, ${targetY.toFixed(2)})</p>`;
    resultDiv.innerHTML += `<p>Target Elevation: ${targetElevation.toFixed(2)} meters</p>`;
    resultDiv.innerHTML += `<p>Horizontal Distance from Your Position to Target: ${horizontalDistanceToTarget.toFixed(2)} meters</p>`;
    resultDiv.innerHTML += `<p>True Distance from Your Position to Target: ${trueDistanceToTarget.toFixed(2)} meters</p>`;
    resultDiv.innerHTML += `<p>Bearing from Your Position to Target: ${bearingToTarget.toFixed(2)}°</p>`;

    // Automatically feed true distance to Section 1
    document.getElementById("distance").value = trueDistanceToTarget.toFixed(2);
}
</script>
</body>
</html>
